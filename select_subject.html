<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•™æç®¡ç† - AIå‹‰å¼·ç®¡ç†</title>
  <style>
    body { font-family: sans-serif; background: #e0f2ff; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; padding-bottom: 100px; }
    h1 { color: #1e40af; font-size: 1.5rem; margin-bottom: 20px; }
    .container { width: 100%; max-width: 400px; }
    
    /* ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .add-form { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; box-sizing: border-box; }
    .add-form input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
    .btn-add { background: #10b981; color: white; border: none; padding: 10px; width: 100%; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 5px; }

    /* æ•™æãƒªã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .subject-card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; position: relative; }
    .subject-name { font-weight: bold; font-size: 1.1rem; color: #333; }
    .btn-delete { position: absolute; top: 10px; right: 10px; background: #ff4d4d; color: white; border: none; border-radius: 4px; font-size: 10px; padding: 4px 8px; cursor: pointer; }

    .sub-container { display: none; margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px; }
    .sub-item { background: #f0f7ff; padding: 10px; border-radius: 8px; margin-bottom: 5px; color: #1a73e8; font-weight: bold; text-align: center; border: 1px solid #bfdbfe; }
    
    .active .sub-container { display: block; }
    .hint { font-size: 0.8rem; color: #666; margin-bottom: 10px; }
  </style>
</head>
<body>

  <h1>ğŸ“š æ•™æã‚’é¸ã¶ãƒ»ç™»éŒ²ã™ã‚‹</h1>

  <div class="add-form">
    <div style="font-weight:bold; margin-bottom:8px; color:#1e40af;">ï¼‹ æ–°ã—ã„æ•™æã‚’ç™»éŒ²</div>
    <input type="text" id="mainName" placeholder="æ•™æå (ä¾‹: Focus Gold)">
    <input type="text" id="subName" placeholder="ç§‘ç›®ãƒ»å·» (ä¾‹: æ•°å­¦B) â€»ç©ºæ¬„OK">
    <input type="number" id="totalCount" placeholder="å…¨ãƒšãƒ¼ã‚¸æ•°/å•é¡Œæ•°" inputmode="numeric">
    <button class="btn-add" onclick="addNewSubject()">ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
  </div>

  <div class="hint">ã‚¿ãƒƒãƒ—ã§ç§‘ç›®ã‚’é¸æŠ â†“</div>
  <div class="container" id="subjectList"></div>

<script>
  // åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆLocalStorageãŒç©ºã®æ™‚ã ã‘è¡¨ç¤ºï¼‰
  const defaultSubjects = [
    { name: "Focus Gold æ•°å­¦I+A", total: 293},
    { name: "Focus Gold æ•°å­¦â… â… ", total: 245},
    { name: "Focus Gold æ•°å­¦B+C", 
      sub: [{ name: "æ•°å­¦B-1", total: 66 }, 
            { name: "æ•°å­¦B-2", total: 16 },
            { name: "æ•°å­¦C-1", total: 81 },
            { name: "æ•°å­¦C-2", total: 84 }
           ] 
    },
    { name: "Focus Gold æ•°å­¦â… â… â… ", total: 221},
    { name: "4STEPæ•°å­¦â… +A", total: 326 },
    { name: "4STEPæ•°å­¦â…¡", total: 514 },
    { name: "4STEPæ•°å­¦B", total: 179 },
    { name: "4STEPæ•°å­¦C", total: 302 },
    { name: "4STEPæ•°å­¦â…¢", total: 342 },
    { name: "ã‚»ãƒŸãƒŠãƒ¼ç‰©ç†åŸºç¤+ç‰©ç†", total: 622 },
    { name: "è‰¯å•ã®é¢¨ç‰©ç†", total: 154 },
    { name: "ã‚¨ã‚¯ã‚»ãƒ«åŒ–å­¦", total: 615 }
  ];

  // ä¿å­˜ã•ã‚ŒãŸæ•™æã‚’èª­ã¿è¾¼ã‚€
  let mySubjects = JSON.parse(localStorage.getItem('mySubjects')) || defaultSubjects;

  function renderSubjects() {
    const listContainer = document.getElementById('subjectList');
    listContainer.innerHTML = '';

    mySubjects.forEach((s, index) => {
      const card = document.createElement('div');
      card.className = 'subject-card';
      
      let html = `<button class="btn-delete" onclick="deleteSubject(${index}); event.stopPropagation();">å‰Šé™¤</button>`;
      
      if (s.sub && s.sub.length > 0) {
        html += `
          <div class="subject-name">${s.name} â–¼</div>
          <div class="sub-container">
            ${s.sub.map(item => `<div class="sub-item" onclick="selectSub('${s.name}ï¼ˆ${item.name}ï¼‰', ${item.total})">${item.name} (å…¨${item.total})</div>`).join('')}
          </div>
        `;
        card.onclick = function(e) {
          if (e.target.className !== 'sub-item' && e.target.className !== 'btn-delete') {
            this.classList.toggle('active');
          }
        };
      } else {
        html += `
          <div class="subject-name">${s.name}</div>
          <div style="font-size:0.8rem; color:#666;">å…¨ ${s.total} å•/ãƒšãƒ¼ã‚¸</div>
        `;
        card.onclick = (e) => {
            if(e.target.className !== 'btn-delete') selectSub(s.name, s.total);
        };
      }
      
      card.innerHTML = html;
      listContainer.appendChild(card);
    });
  }

  // æ–°ã—ã„æ•™æã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
  function addNewSubject() {
    const main = document.getElementById('mainName').value.trim();
    const sub = document.getElementById('subName').value.trim();
    const total = parseInt(document.getElementById('totalCount').value) || 0;

    if (!main) return alert("æ•™æåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

    // ã™ã§ã«åŒã˜å¤§é …ç›®ãŒã‚ã‚‹ã‹æ¢ã™
    const existing = mySubjects.find(s => s.name === main);

    if (sub) {
      if (existing) {
        // ã™ã§ã«å¤§é …ç›®ãŒã‚ã‚Œã°ã€ãã®ä¸­ã«subã‚’è¿½åŠ 
        if (!existing.sub) existing.sub = [];
        existing.sub.push({ name: sub, total: total });
      } else {
        // æ–°ã—ãéšå±¤ã‚’ä½œã‚‹
        mySubjects.push({ name: main, sub: [{ name: sub, total: total }] });
      }
    } else {
      // subãŒãªã„å ´åˆã¯ãã®ã¾ã¾è¿½åŠ 
      mySubjects.push({ name: main, total: total });
    }

    saveAndRender();
    // å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
    document.getElementById('mainName').value = '';
    document.getElementById('subName').value = '';
    document.getElementById('totalCount').value = '';
  }

  function deleteSubject(index) {
    if (confirm("ã“ã®æ•™æã‚’ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
      mySubjects.splice(index, 1);
      saveAndRender();
    }
  }

  function saveAndRender() {
    localStorage.setItem('mySubjects', JSON.stringify(mySubjects));
    renderSubjects();
  }

  function selectSub(name, total) {
    location.href = `index.html?subject=${encodeURIComponent(name)}&total=${total}`;
  }

  // åˆå›è¡¨ç¤º
  renderSubjects();
</script>
</body>
</html>